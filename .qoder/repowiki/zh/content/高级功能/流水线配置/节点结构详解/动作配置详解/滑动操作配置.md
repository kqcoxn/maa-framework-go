# 滑动操作配置

<cite>
**本文档引用文件**   
- [pipeline.go](file://pipeline.go#L1420-L1639)
- [context_test.go](file://context_test.go#L707-L736)
- [target.go](file://internal/target/target.go)
- [rect.go](file://internal/rect/rect.go)
</cite>

## 目录
1. [NodeActionTypeSwipe参数结构](#nodeactiontypeswipe参数结构)
2. [ActSwipe构造函数配置选项](#actswipe构造函数配置选项)
3. [起点与终点Target类型配置方法](#起点与终点target类型配置方法)
4. [滑动速度(Speed)参数影响](#滑动速度speed参数影响)
5. [滑动模式配置差异](#滑动模式配置差异)
6. [复杂滑动路径配置示例](#复杂滑动路径配置示例)
7. [时序控制参数说明](#时序控制参数说明)

## NodeActionTypeSwipe参数结构

NodeActionTypeSwipe操作通过NodeSwipeParam结构体定义其参数，该结构体包含滑动操作的完整配置信息。主要参数包括：

- **Begin**: 滑动起点位置，类型为Target
- **BeginOffset**: 起点附加偏移量，类型为Rect
- **End**: 滑动终点位置，类型为Target数组
- **EndOffset**: 终点附加偏移量，类型为Rect数组
- **Duration**: 滑动持续时间（毫秒），类型为int64数组
- **EndHold**: 到达终点后保持时间（毫秒），类型为int64数组
- **OnlyHover**: 是否仅悬停模式（不执行按下/释放操作），类型为bool
- **Contact**: 触控点标识符，Adb为手指索引，Win32为鼠标按钮

**Section sources**
- [pipeline.go](file://pipeline.go#L1420-L1438)

## ActSwipe构造函数配置选项

ActSwipe函数使用函数式选项模式（functional options）来配置滑动操作，通过传入一系列SwipeOption类型的函数来设置参数。主要配置选项包括：

- **WithSwipeBegin**: 设置滑动起点位置
- **WithSwipeBeginOffset**: 设置起点附加偏移量
- **WithSwipeEnd**: 设置滑动终点位置
- **WithSwipeEndOffset**: 设置终点附加偏移量
- **WithSwipeDuration**: 设置滑动持续时间
- **WithSwipeEndHold**: 设置终点保持时间
- **WithSwipeOnlyHover**: 设置仅悬停模式
- **WithSwipeContact**: 设置触控点标识符

这些选项函数接收相应的参数并返回一个函数，该函数在ActSwipe内部被调用以配置NodeSwipeParam实例。

**Section sources**
- [pipeline.go](file://pipeline.go#L1442-L1507)

## 起点与终点Target类型配置方法

Target类型是一个类型安全的变体，可以持有bool、string或rect.Rect三种值类型之一。对于滑动操作，通常使用rect.Rect类型来指定坐标位置。

Target类型的创建方法：
- **NewTargetBool**: 创建布尔类型的Target
- **NewTargetString**: 创建字符串类型的Target  
- **NewTargetRect**: 创建矩形区域类型的Target

在滑动操作中，起点（Begin）和终点（End）都使用Target类型来表示位置。当需要指定具体坐标时，应使用NewTargetRect创建包含坐标信息的Target实例。Rect结构体由四个整数组成，分别表示X坐标、Y坐标、宽度和高度。

**Section sources**
- [target.go](file://internal/target/target.go)
- [rect.go](file://internal/rect/rect.go)

## 滑动速度(Speed)参数影响

滑动速度通过Duration参数间接控制，该参数定义了从起点到终点的滑动持续时间（以毫秒为单位）。Duration参数是一个int64数组，允许为多个终点配置不同的持续时间。

滑动速度的影响：
- **较短的Duration值**：产生快速滑动效果，模拟快速手势操作
- **较长的Duration值**：产生缓慢滑动效果，模拟精细控制操作
- **速度与用户体验**：适当的滑动速度可以提高自动化操作的自然度和成功率
- **速度与系统响应**：过快的滑动可能导致系统无法正确识别手势，过慢的滑动可能触发意外的长按操作

通过调整Duration参数，可以精确控制滑动操作的速度，以适应不同应用场景的需求。

**Section sources**
- [pipeline.go](file://pipeline.go#L1430-L1431)

## 滑动模式配置差异

框架支持多种滑动模式，每种模式有其特定的配置方式：

### 普通滑动（Swipe）
使用NodeSwipeParam配置单点滑动操作，通过Begin和End参数定义滑动路径。适用于大多数常规滑动场景。

### 快速滑动（Quick Swipe）
通过设置较短的Duration值（如100-200毫秒）实现快速滑动效果。这种模式模拟用户快速划过屏幕的手势。

### 多点滑动（MultiSwipe）
使用NodeMultiSwipeParam配置多点滑动操作，支持同时执行多个滑动动作。MultiSwipeItem的配置要点包括：
- **Starting**: 定义每个滑动动作的开始时间（相对于操作开始的毫秒数）
- **Begin/End**: 定义每个滑动的起点和终点
- **Duration**: 定义每个滑动的持续时间
- **Contact**: 指定每个滑动使用的触控点标识符

多点滑动允许精确控制多个手指的协同动作，适用于复杂的手势操作。

**Section sources**
- [pipeline.go](file://pipeline.go#L1519-L1639)

## 复杂滑动路径配置示例

虽然基本的滑动操作只支持直线路径，但可以通过连续执行多个滑动操作来模拟复杂路径。配置复杂滑动路径的关键是合理设置各个滑动操作的参数：

1. **分段滑动**：将复杂路径分解为多个直线段，每个段作为一个独立的滑动操作
2. **时间协调**：通过PreDelay和PostDelay参数控制各段滑动之间的时间间隔
3. **位置衔接**：确保前一段滑动的终点与后一段滑动的起点相匹配
4. **速度变化**：根据不同路径段的需求调整滑动速度

对于需要多点协同的复杂手势，使用MultiSwipe模式可以同时控制多个触控点的移动，实现更复杂的交互效果。

**Section sources**
- [context_test.go](file://context_test.go#L738-L776)

## 时序控制参数说明

滑动操作中的时序控制通过多个参数实现：

### PreDelay/PostDelay参数
- **PreDelay**: 在执行滑动操作前的延迟时间
- **PostDelay**: 在完成滑动操作后的延迟时间
- 这些参数用于控制操作与其他动作的时间关系，确保操作序列的正确执行顺序

### WaitFreezes参数
WaitFreezes参数用于在滑动操作前后等待界面稳定，其配置包括：
- **time**: 等待的最长时间
- **target**: 等待的目标状态
- **threshold**: 变化阈值
- **method**: 检测方法
- **rate_limit**: 检测频率限制
- **timeout**: 超时时间

这些时序控制参数共同作用，确保滑动操作在合适的时机执行，并在操作后给予系统足够的响应时间，提高自动化操作的可靠性和稳定性。

**Section sources**
- [context_test.go](file://context_test.go#L1136-L1148)